<link rel="import" href="pws-app-elements/pws-elements.html">
<link rel="import" href="bower_components/polymerfire/polymerfire.html">

<dom-module id="pws-app">
  <template>
    <style include="pws-app-shared-styles"></style>

    <firebase-auth
        id="auth"
        app-name="pws"
        provider="google"
        signed-in="{{signedIn}}"
        user="{{user}}">
    </firebase-auth>

    <firebase-document
        id="document"
        app-name="pws"
        path="[[editableShiftId]]"
        data="{{editableShift}}">
    </firebase-document>

    <!-- <firebase-query
        app-name="pws"
        path="/shifts/[[user.uid]]"
        data="{{shifts}}">
    </firebase-query> -->

    <firebase-query
        app-name="pws"
        path="/locations"
        data="{{locations}}">
    </firebase-query>

    <pws-toolbar
        signed-in="[[signedIn]]"
        on-sign-out="signOut"></pws-toolbar>

    <!-- <firebase-query
        app-name="pws"
        path="/shifts/[[searchDate]]"
        data="{{shifts}}">
    </firebase-query> -->

    <pws-login
        on-sign-in="signIn"
        signed-in="[[signedIn]]"
        disabled="[[!online]]">
    </pws-login>

    <pws-shift-editor
        id="editor"
        locations="[[locations]]"
        shift="{{editableShift}}"
        on-close="commitChange"></pws-shift-editor>

    <template is="dom-repeat" items="[[locations]]" as="location">
      <paper-card class="location" heading="[[location.name]]" style="margin-top:4px; margin-bottom:4px;">
        <div class="card-actions">
          <p>Availability</p>
          <div class="horizontal justified">
            <paper-icon-button icon="icons:event"></paper-icon-button>
            <div style="display:inline-block; border: 1px solid grey;">
              <paper-button data-location-id$="[[location.$key]]" data-search-date$="[[searchDate]]" data-shift-time="7AM - 9AM" on-tap="createPrefilledShift">7AM - 9AM</paper-button>
              <div style="text-align: center;">3</div>
            </div>
            <paper-button>9AM - 11AM</paper-button>
            <paper-button>11AM - 1PM</paper-button>
            <paper-button>1PM - 3PM</paper-button>
            <paper-button>5PM - 7PM</paper-button>
          </div>
        </div>
      </paper-card>
    </template>
        <!-- <div class="notes">
          <template is="dom-repeat" items="[[shifts]]" as="note">
            <pws-shift
                id$="[[note.$key]]"
                shift="[[note]]"
                locations="[[locations]]"
                on-tap="edit">
            </pws-shift>
          </template>
        </div> -->

    <paper-fab
        icon="add"
        on-tap="create"
        disabled="[[!online]]"
        aria-label="Book shift">
    </paper-fab>
  </template>
  <script>
    Polymer({
      is: 'pws-app',

      behaviors: [Polymer.PWSAppBehaviour],

      signIn: function() {
        this.$.auth.signInWithPopup();
      },

      createPrefilledShift: function(event) {
        console.log('dataset', event.target.dataset);
        console.log('this.searchDate', this.searchDate);
        this.$.editor.shift.location = event.target.dataset.locationId;
        this.$.editor.shift.time = event.target.dataset.shiftTime;
        this.$.editor.shift.date = this.searchDate;
        this.create();
      },

      get shiftsPath() {
        // return '/shifts/' + this.user.uid;
        return '/shifts/';
      },

      toEditableId: function(shiftId) {
        return this.shiftsPath + '/' + shiftId;
      },

      get isEditable() {
        return this.online;
      }
    });
  </script>
</dom-module>
